# book-service-homework
üìù –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ 1

–î–æ–±–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –≤—ã–≤–æ–¥–∞ –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –æ–¥–Ω–∏–º —Å–ø–∏—Å–∫–æ–º.

–í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä `AccountController` –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥:
```java
@GetMapping
public List<AccountDto> getAllAccounts() {
    return accountService.getAllAccounts();
}
```

–í —Å–µ—Ä–≤–∏—Å–µ `AccountService` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥:
```java
public List<AccountDto> getAllAccounts() {
    return accountRepository.findAll().stream()
            .map(accountMapper::toDto)
            .collect(Collectors.toList());
}
```

üìù –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ 2

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —É—á—ë—Ç–∞ –∫–Ω–∏–≥.

–í—ã–±—Ä–∞–Ω –≤—Ç–æ—Ä–æ–π –≤–∞—Ä–∏–∞–Ω—Ç —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞

**–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –±–∞–∑—ã –∏ —Å—Ö–µ–º—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–Ω–∏–≥**

```sql
-- —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE USER books_user WITH PASSWORD 'books_password';

-- —Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã
CREATE DATABASE booksdb OWNER books_user;

-- —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã
CREATE SCHEMA IF NOT EXISTS books;

-- –≤—ã–¥–∞—á–∞ –ø—Ä–∞–≤ –Ω–∞ —Å—Ö–µ–º—É
GRANT ALL ON SCHEMA books TO books_user;
```

**Liquibase**

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –∏ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∏—Ö –¥–∞–Ω–Ω—ã–º–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–≤–∞ SQL-—Ñ–∞–π–ª–∞:
- `schema-books.sql` ‚Äî —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É –∫–Ω–∏–≥:
  ```sql
  CREATE TABLE IF NOT EXISTS books.book (
      id SERIAL PRIMARY KEY,
      title VARCHAR(255) NOT NULL,
      author VARCHAR(255) NOT NULL,
      status VARCHAR(32),
      user_id BIGINT
  );
  ```
- `data-books.sql` ‚Äî –Ω–∞–ø–æ–ª–Ω—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
  ```sql
  INSERT INTO books.book (title, author, status, user_id) VALUES
  ('–í–æ–π–Ω–∞ –∏ –º–∏—Ä', '–õ–µ–≤ –¢–æ–ª—Å—Ç–æ–π', 'AVAILABLE', NULL),
  ('–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∏ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ', '–§—ë–¥–æ—Ä –î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π', 'AVAILABLE', NULL),
  ('–ú–∞—Å—Ç–µ—Ä –∏ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞', '–ú–∏—Ö–∞–∏–ª –ë—É–ª–≥–∞–∫–æ–≤', 'AVAILABLE', NULL);
  ```

**–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä**

`BookController` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–Ω–∏–≥–∞–º–∏:
- –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–Ω–∏–≥: `GET /v1/books`
- –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ –ø–æ id: `GET /v1/books/{id}`
- –≤—ã–¥–∞—á–∞ –∫–Ω–∏–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: `POST /v1/books/{id}/issue?userId=...`
- –≤–æ–∑–≤—Ä–∞—Ç –∫–Ω–∏–≥–∏: `POST /v1/books/{id}/return?userId=...`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ FeignClient**

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –≤—ã–¥–∞—á–µ/–≤–æ–∑–≤—Ä–∞—Ç–µ –∫–Ω–∏–≥–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è FeignClient:
```java
@FeignClient(name = "user-service", url = "http://localhost:8080/v1")
public interface UserClient {
    @GetMapping("/user/{id}")
    UserDto getUserById(@PathVariable("id") Long id);
}
```

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ BookService —Å —Å–µ—Ä–≤–∏—Å–æ–º –∞–∫–∫–∞—É–Ω—Ç–æ–≤**

–í —Å–µ—Ä–≤–∏—Å–µ `BookService` –ø—Ä–∏ –≤—ã–¥–∞—á–µ –∫–Ω–∏–≥–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥ FeignClient –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```java
UserDto user = userClient.getUserById(userId);
if (user == null) {
    throw new RuntimeException("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");
}
```
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∫–Ω–∏–≥–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –≤—ã–¥–∞–Ω–Ω–∞—è —ç—Ç–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ —Ç–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –∫–Ω–∏–≥—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ—Ç –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å



